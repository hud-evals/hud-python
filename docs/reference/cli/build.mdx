---
title: "hud build"
description: "Build production images and generate lock files for reproducible environments"
icon: "hammer"
---

The `hud build` command builds your Docker image, analyzes its MCP server, and writes a reproducible `hud.lock.yaml`.

## Usage

```bash
hud build [DIRECTORY] [OPTIONS]
```

## Arguments

<ParamField path="directory" type="string" default=".">
  Environment directory containing Dockerfile and pyproject.toml
</ParamField>

## Options

<ParamField path="--tag" type="string">
  Docker image tag to use. Defaults to `[tool.hud.image]` or `{dir}:dev`.
</ParamField>

<ParamField path="--no-cache" type="boolean" default="false">
  Build without using Docker cache
</ParamField>

<ParamField path="--verbose" type="boolean" default="false">
  Show detailed build output. Short: `-v`
</ParamField>

<ParamField path="--platform" type="string" default="linux/amd64">
  Target platform for Docker build. Defaults to `linux/amd64` if unspecified.
</ParamField>

## What It Does

<Steps>
<Step title="Build Docker Image">
Runs `docker build` (twice): a temporary build for analysis, then a labeled build for the final image and version tags.
</Step>

<Step title="Analyze Environment">
Runs the container via MCP to measure initialize time and list tools (count and input schemas).
</Step>

<Step title="Generate Lock File">
Writes `hud.lock.yaml` with:
- `version`: lock format version
- `image`: `{tag}@sha256:<id>` after final build
- `build`: generatedAt, hudVersion, directory, internal `version` (semver, auto‑incremented), `sourceHash`, optional `sourceFiles`
- `environment`: initializeMs, toolCount, and optional `variables` with `provided`, `required`, `optional`
- `tools`: name, description, inputSchema (for RL/evals tooling)
</Step>

<Step title="Retag & Label">
Adds labels (`org.hud.*`) and tags the image with both the chosen tag and the internal version.
</Step>
</Steps>

## Examples

```bash
# Basic build (auto tag)
hud build

# Custom tag
hud build . --tag v1.2.0

# Clean build with logs
hud build . --no-cache --verbose

# Force cross‑platform (useful on Apple Silicon)
hud build . --platform linux/amd64
```

## Image Naming

If `--tag` is not provided:
1. Read `[tool.hud.image]` from `pyproject.toml`
2. Otherwise use `{directory-name}:dev`

## Environment Variables

Pass runtime environment variables during analysis with `-e`/`--env` flags:

```bash
hud build . -e API_KEY=secret -e DEBUG=true
```

They’re recorded in the lock file as placeholders under `environment.variables.provided`; missing required variables are listed in `environment.variables.required`.

## Lock File

Minimal structure you’ll see:

```yaml
version: "1.2"
image: "my-env:0.1.0@sha256:..."
build:
  generatedAt: "2025-01-01T12:00:00Z"
  hudVersion: "0.x.y"
  directory: "my-env"
  version: "0.1.0"
  sourceHash: "..."
  baseImage: "python:3.11-slim"
  platform: "linux/amd64"
environment:
  initializeMs: 450
  toolCount: 3
  runtime:
    python: "3.11.6"
    cuda: null
    cudnn: null
    pytorch: null
  variables:
    provided: { API_KEY: "${API_KEY}" }
    required: ["OTHER_KEY"]
tools:
  - name: setup
    description: Initialize environment
    inputSchema: { type: object }
    internalTools: ["board", "seed"]
```

## Next Steps

```bash
# Hot‑reload development
hud dev

# Run the built image locally (stdio)
hud run my-env:dev --local

# Push to registry
hud push
```

## See Also

- [`hud init`](/reference/cli/init)
- [`hud dev`](/reference/cli/dev)
- [`hud push`](/reference/cli/push)
- [`hud analyze`](/reference/cli/analyze)
- [Build Environments](/build-environments)
